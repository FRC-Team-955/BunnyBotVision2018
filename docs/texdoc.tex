\documentclass[12pt, english]{article}
\usepackage{mathtools}
\usepackage{amssymb}

\usepackage{listings}
\usepackage{xcolor}

\lstset { %
    language=C++,
    backgroundcolor=\color{black!5}, % set backgroundcolor
    basicstyle=\footnotesize,% basic font setting
}

\date{}
\title{ Motion planning with TinySpline and OpenCV }
\begin{document}
\author{
	Duncan Freeman
}

\maketitle

\noindent
	\bgroup\obeylines
	Q: Why do you even want to use splines anyway?
	A: Because they're \textit{cool}
	\egroup

\tableofcontents
\newpage

\section{Introduction/Why}
But seriously, we use splines because they give us an optimal path to a target without having to waste time stopping and turning. We turn \textit{while} we move. This is important because it saves time during the autonomous period in FRC, as well as giving us more margin in teleop (when we wish to use autonomous functions during teleop). This document details how we accomplish this, mainly how all of the math that goes into it works.

\section{Libraries used}
Tiny spline is a library for calculating an n-dimensional paramatric function (spline) given a number of control points. Details about their software are available at https://tinyspline.org/ . We also use an open source computer vision library called OpenCV to find our goal, available at https://opencv.org

\section{Control Points}
\textbf{File: ../src/goal\_path\_calculator.cpp} \\
Because our goals have both a position and a direction, we use a combination of 3 control points for each goal. The first control point, located exactly at our goal's location, determines where we want to end up. The second, located at an offset and from our goal's position based off of the goal's orientation, makes sure that the robot ends oriented at our goal. The third, located at \textit{double} the offset distance from the goal's position, makes sure that we have a margin to finish turning at our desired location. If the location of the goal is $(x, y)$, the direction of the goal $\theta$ (In radians), and the distance we want to move out from the goal $d$ (usually the distance between the wheels of the bot), then the locations of the 3 goals are as follows (in order): \\
\\
$(x, y)$ \\
$(\cos{\theta} * d, \sin{\theta} * d) + (x, y)$ \\
$(\cos{\theta} * d * 2, \sin{\theta} * d * 2) + (x, y)$ \\
\\
Note: The order of these points is reversed for the \textit{end} of the spline

\textbf{TODO: Include picture, have directory for example screenshot codes}

\section{Finding the positions of each wheel}
Offset of each wheel from a point along the curve (given by $x(i)$ and $y(i)$ where $i\in(0,1)$) with distance d can be given by the equation below: \\
\begin{equation}
	(x(i), y(i)) \pm d \left(\frac{(-y'(i), x'(i))}{\sqrt{x'(i)+y'(i)}}\right)
\end{equation}

\section{Finding the velocities of each wheel}
To find the velocity of each wheel, we can simply derive the position of each like so:
\begin{equation}
	(x'(i), y'(i)) \pm d\frac{(-y''(i), x''(i))*\sqrt{x'(i)^2+y'(i)^2} - (-y'(i), x(i)) * \frac{y''(i)y'(i) + x''(i)x'(i)}{\sqrt{x'(i)^2+y'(i)^2}}}{x'(i)+y'(i)}
\end{equation}

\end{document}
